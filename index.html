<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Libemf2svg by kakwa</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Libemf2svg</h1>
        <p>EMF to SVG conversion library</p>
        <p class="view"><a href="https://github.com/kakwa/libemf2svg">View the Project on GitHub <small>kakwa/libemf2svg</small></a></p>
        <ul>
          <li><a href="https://github.com/kakwa/libemf2svg/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/kakwa/libemf2svg/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/kakwa/libemf2svg">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="libemf2svg" class="anchor" href="#libemf2svg" aria-hidden="true"><span class="octicon octicon-link"></span></a>libemf2svg</h1>

<p><a href="https://travis-ci.org/kakwa/libemf2svg"><img src="https://travis-ci.org/kakwa/libemf2svg.svg?branch=master" alt="Build Status"></a></p>

<p>EMF to SVG conversion library</p>

<h2>
<a id="disclaimer" class="anchor" href="#disclaimer" aria-hidden="true"><span class="octicon octicon-link"></span></a>Disclaimer</h2>

<p><strong>Work in progress.</strong></p>

<h2>
<a id="output-example" class="anchor" href="#output-example" aria-hidden="true"><span class="octicon octicon-link"></span></a>Output example</h2>

<p><img src="https://cdn.rawgit.com/kakwa/libemf2svg/master/goodies/demo-example.svg" alt="Example"></p>

<h2>
<a id="building" class="anchor" href="#building" aria-hidden="true"><span class="octicon octicon-link"></span></a>Building</h2>

<p>Commands to build this project:</p>

<div class="highlight highlight-bash"><pre>
<span class="pl-c"># options: </span>
<span class="pl-c"># * [-DUSE_CLANG=on]: use clang instead of gcc</span>
<span class="pl-c"># * [-DSTATIC=on]: build static library</span>
<span class="pl-c"># * [-DDEBUG=on]: compile with debugging symbols</span>
<span class="pl-c">#</span>
<span class="pl-c"># CMAKE_INSTALL_PREFIX is optional, default is /usr/local/</span>
$ cmake <span class="pl-s3">.</span> -DCMAKE_INSTALL_PREFIX=/usr/

<span class="pl-c"># compilation</span>
$ make

<span class="pl-c"># installation</span>
$ make install</pre></div>

<h2>
<a id="command-line-tool" class="anchor" href="#command-line-tool" aria-hidden="true"><span class="octicon octicon-link"></span></a>Command line tool</h2>

<div class="highlight highlight-bash"><pre>$ ./emf2svg --help
Usage: emf2svg [OPTION...] -i FILE -o FILE
emf2svg -- Enhanced Metafile to SVG converter

  -h, --height=HEIGHT        Max height <span class="pl-k">in</span> px
  -i, --input=FILE           Input EMF file
  -o, --output=FILE          Output SVG file
  -p, --emfplus              Handle EMF+ records
  -v, --verbose              Produce verbose output
  -w, --width=WIDTH          Max width <span class="pl-k">in</span> px
  -<span class="pl-k">?</span>, --help                 Give this <span class="pl-s3">help</span> list
      --usage                Give a short usage message
  -V, --version              Print program version

Mandatory or optional arguments to long options are also mandatory or optional
<span class="pl-k">for</span> <span class="pl-vo">any</span> corresponding short options.

Report bugs to <span class="pl-k">&lt;</span>carpentier.pf@gmail.com<span class="pl-k">&gt;</span>.

<span class="pl-c"># usage example:</span>
$ ./emf2svg -i ./tests/resources/emf/test-037.emf -o example.svg -v</pre></div>

<h2>
<a id="library" class="anchor" href="#library" aria-hidden="true"><span class="octicon octicon-link"></span></a>Library</h2>

<p>Shorten example (<a href="https://github.com/kakwa/libemf2svg/blob/master/goodies/example.c">complete example here</a>):</p>

<div class="highlight highlight-C"><pre>#<span class="pl-k">include</span> <span class="pl-s1"><span class="pl-pds">&lt;</span>EMFSVG.h<span class="pl-pds">&gt;</span></span>
<span class="pl-c">//[...]</span>
<span class="pl-st">int</span> <span class="pl-en">main</span>(<span class="pl-st">int</span> argc, <span class="pl-st">char</span> *argv[]){

    <span class="pl-c">/* emf content size */</span>
    <span class="pl-s3">size_t</span> emf_size;
    <span class="pl-c">/* emf content */</span>
    <span class="pl-st">char</span> * emf_content;
    <span class="pl-c">/* svg output string */</span>
    <span class="pl-st">char</span> *svg_out = <span class="pl-c1">NULL</span>;

    <span class="pl-c">//[...]</span>

    <span class="pl-c">/*************************** options settings **************************/</span>

    <span class="pl-c">/* allocate the options structure) */</span>
    generatorOptions *options = (generatorOptions *)<span class="pl-s3">calloc</span>(<span class="pl-c1">1</span>, \
            <span class="pl-k">sizeof</span>(generatorOptions));
    <span class="pl-c">/* debugging flag (prints the emf record in stdout if true) */</span>
    options-&gt;verbose = <span class="pl-c1">true</span>;
    <span class="pl-c">/* emf+ flag (handles emf+ records if true) */</span>
    options-&gt;emfplus = <span class="pl-c1">true</span>;
    <span class="pl-c">/* if a custom xml/svg namespace is needed (keep empty in doubt) */</span>
    options-&gt;nameSpace = (<span class="pl-st">char</span> *)<span class="pl-s1"><span class="pl-pds">"</span>svg<span class="pl-pds">"</span></span>;
    <span class="pl-c">/* includes the svg start and stop tags (set to false if the result</span>
<span class="pl-c">     * of this call is meant to be used inside another svg) */</span>
    options-&gt;svgDelimiter = <span class="pl-c1">true</span>;
    <span class="pl-c">/* image width in px (set to 0 to use the original emf device width) */</span>
    options-&gt;imgWidth = <span class="pl-c1">0</span>;
    <span class="pl-c">/* image height in px (set to 0 to use the original emf device height) */</span>
    options-&gt;imgHeight = <span class="pl-c1">0</span>;

    <span class="pl-c">/***************************** conversion ******************************/</span>

    <span class="pl-st">int</span> ret = <span class="pl-s3">emf2svg</span>(emf_content, emf_size, &amp;svg_out, options);

    <span class="pl-c">/***********************************************************************/</span>

    <span class="pl-c">//[...]</span>
}</pre></div>

<p>See <a href="https://github.com/kakwa/libemf2svg/blob/master/src/conv/emf2svg.cpp">./src/conv/emf2svg.cpp</a> for a real life example.</p>

<h2>
<a id="development" class="anchor" href="#development" aria-hidden="true"><span class="octicon octicon-link"></span></a>Development</h2>

<p>General source code organisation:</p>

<ul>
<li>
<a href="https://github.com/kakwa/libemf2svg/blob/master/src/lib/EMFSVG.c">./src/lib/EMFSVG.c</a>: EMF record handler and API entry point.</li>
<li>
<a href="https://github.com/kakwa/libemf2svg/blob/master/src/lib/EMFSVG_print.c">./src/lib/EMFSVG_print.c</a>: EMF record printer (debugging).</li>
<li>
<a href="https://github.com/kakwa/libemf2svg/blob/master/src/lib/PMFSVG.c">./src/lib/PMFSVG.c</a>: EMF+ record handler.</li>
<li>
<a href="https://github.com/kakwa/libemf2svg/blob/master/src/lib/PMFSVG_print.c">./src/lib/PMFSVG_print.c</a>: EMF+ record printer (debugging).</li>
<li>
<a href="https://github.com/kakwa/libemf2svg/blob/master/src/conv/emf2svg.cpp">./src/conv/emf2svg.cpp</a>: Command line tool.</li>
<li>
<a href="https://github.com/kakwa/libemf2svg/blob/master/deps">./deps</a>: external dependencies.</li>
</ul>

<p>Useful links:</p>

<ul>
<li>
<a href="http://msdn.microsoft.com/en-us/library/cc230514.aspx">MS-EMF</a>: EMF specifications.</li>
<li>
<a href="http://msdn.microsoft.com/en-us/library/cc230724.aspx">MS-EMF+</a>: EMF+ specifications.</li>
<li>
<a href="http://msdn.microsoft.com/en-us/library/cc250370.aspx">MS-WMF</a>: WMF specifications.</li>
<li>
<a href="http://www.w3.org/TR/SVG/Overview.html">SVG</a>: SVG specifications.</li>
</ul>

<h2>
<a id="testing" class="anchor" href="#testing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Testing</h2>

<ul>
<li>Stats on the number of emf records covered:</li>
</ul>

<div class="highlight highlight-bash"><pre>$ ./tests/resources/coverage.sh</pre></div>

<ul>
<li>Fuzzing on the library:</li>
</ul>

<div class="highlight highlight-bash"><pre>$ ./tests/resources/check_corrupted.sh

<span class="pl-c"># generated corrupted files crashing the library are stored here:</span>
ls ./tests/out/bad<span class="pl-k">*</span>
tests/out/bad_corrupted_2014-12-01-063258.emf
</pre></div>

<ul>
<li>Check correctness and memory leaks (xmllint and valgrind needed):</li>
</ul>

<div class="highlight highlight-bash"><pre><span class="pl-c"># options: -n to disable valgrind tests, -v for verbose output </span>
<span class="pl-c"># see -h for complete list of options</span>
$ ./tests/resources/check_correctness.sh <span class="pl-c">#[-n] [-v]</span>

<span class="pl-c"># generated svg:</span>
$ ls tests/out/test-<span class="pl-k">*</span>
tests/out/test-000.emf.svg  tests/out/test-051.emf.svg
[...]</pre></div>

<p>The emf files used for these checks are located in <a href="https://github.com/kakwa/libemf2svg/blob/master/tests/resources/emf/">./tests/resources/emf/</a>.</p>

<h2>
<a id="useful-commands" class="anchor" href="#useful-commands" aria-hidden="true"><span class="octicon octicon-link"></span></a>Useful Commands</h2>

<p>To build, run on emf test files and visualize (with geeqie):</p>

<div class="highlight highlight-bash"><pre>$ cmake <span class="pl-s3">.</span><span class="pl-k">&amp;&amp;</span> \
    make <span class="pl-k">&amp;&amp;</span>\
    <span class="pl-s1"><span class="pl-pds">"</span>./tests/resources/check_correctness.sh<span class="pl-pds">"</span></span> -n <span class="pl-k">&amp;&amp;</span>\
    geeqie <span class="pl-s1"><span class="pl-pds">"</span>tests/out<span class="pl-pds">"</span></span></pre></div>

<p>To check against corrupted emf:</p>

<div class="highlight highlight-bash"><pre>$ cmake -DDEBUG=ON <span class="pl-s3">.</span> <span class="pl-k">&amp;&amp;</span>\
    make <span class="pl-k">&amp;&amp;</span>\
    <span class="pl-s1"><span class="pl-pds">"</span>./tests/resources/check_correctness.sh<span class="pl-pds">"</span></span> -sxN \
    -e <span class="pl-s1"><span class="pl-pds">"</span>./tests/resources/emf-corrupted/<span class="pl-pds">"</span></span></pre></div>
      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/kakwa">kakwa</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>